#include "prussints.hp"

.origin 0
.entrypoint START

START:

LBCO r0, CONST_PRUCFG, 4, 4
CLR  r0, r0, 4
SBCO r0, CONST_PRUCFG, 4, 4

MOV r7, 0xdeadbeef
SBCO &r7, CONST_PRUDRAM, 0, 4
MOV r31.b0, PRU0_ARM_INTERRUPT+16

INITLOOP:
MOV r0, 0x7FFFFFFF
             		 
HIGHLOOP:
QBBS HIGHLOOP, r31, 16

LOWLOOP:
QBBC LOWLOOP, r31, 16

SUB r0, r0, 1
	
QBEQ OVERFLOW, r0, 0
SBCO &r0, CONST_PRUDRAM, 0, 4	
// QBGT COMMS, r1, 0xFF	
QBA HIGHLOOP

COMMS:
SBCO &r0, CONST_PRUDRAM, 0, 4
MOV r1, 0x0
QBA HIGHLOOP
	
OVERFLOW:
SBCO &r0, CONST_PRUDRAM, 0, 4   
MOV r31.b0, PRU0_ARM_INTERRUPT+16
QBA INITLOOP
	 
HALT
